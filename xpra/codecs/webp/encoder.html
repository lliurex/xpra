<!DOCTYPE html>
<!-- Generated by Cython 0.26.1 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: encoder.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
    <script>
    function toggleDiv(id) {
        theDiv = id.nextElementSibling
        if (theDiv.style.display != 'block') theDiv.style.display = 'block';
        else theDiv.style.display = 'none';
    }
    </script>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.26.1</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="encoder.c">encoder.c</a></p>
<div class="cython"><pre class="cython line score-0">&#xA0;<span class="">001</span>: # This file is part of Xpra.</pre>
<pre class="cython line score-0">&#xA0;<span class="">002</span>: # Copyright (C) 2014-2018 Antoine Martin &lt;antoine@xpra.org&gt;</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: # Xpra is released under the terms of the GNU GPL v2, or, at your option, any</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: # later version. See the file COPYING for details.</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #cython: auto_pickle=False, cdivision=True, language_level=3</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: from __future__ import absolute_import</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: </pre>
<pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">010</span>: import os</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_os, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_os, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">011</span>: </pre>
<pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">012</span>: from xpra.log import Logger</pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Logger);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Logger);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_Logger);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_xpra_log, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_3, __pyx_n_s_Logger);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Logger, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 12, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-16" onclick='toggleDiv(this)'>+<span class="">013</span>: log = Logger("encoder", "webp")</pre>
<pre class='cython code score-16 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_Logger);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_tuple__10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_log, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple__10 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_encoder, __pyx_n_u_webp);<span class='error_goto'> if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__10);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__10);
</pre><pre class="cython line score-0">&#xA0;<span class="">014</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: from libc.stdlib cimport free</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: from libc.string cimport memset</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: from xpra.buffers.membuf cimport object_as_buffer</pre>
<pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">019</span>: from xpra.os_util import bytestostr</pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_bytestostr);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_bytestostr);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_bytestostr);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_xpra_os_util, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_3, __pyx_n_s_bytestostr);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_bytestostr, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 19, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">020</span>: </pre>
<pre class="cython line score-29" onclick='toggleDiv(this)'>+<span class="">021</span>: from xpra.util import envbool, envint</pre>
<pre class='cython code score-29 '>  __pyx_t_3 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_envbool);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_envbool);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 0, __pyx_n_s_envbool);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_envint);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_envint);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_3, 1, __pyx_n_s_envint);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_xpra_util, __pyx_t_3, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_envbool);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_envbool, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_envint);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_envint, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 21, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">022</span>: cdef int LOG_CONFIG = envbool("XPRA_WEBP_LOG_CONFIG", False)</pre>
<pre class='cython code score-18 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_envbool);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple__11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_LOG_CONFIG = __pyx_t_4;
/* … */
  __pyx_tuple__11 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_LOG_CONFIG, Py_False);<span class='error_goto'> if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 22, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__11);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__11);
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">023</span>: cdef int WEBP_THREADING = envbool("XPRA_WEBP_THREADING", True)</pre>
<pre class='cython code score-18 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_envbool);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_tuple__12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_WEBP_THREADING = __pyx_t_4;
/* … */
  __pyx_tuple__12 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_THREADING, Py_True);<span class='error_goto'> if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 23, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__12);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__12);
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">024</span>: cdef int LOSSLESS_THRESHOLD = envint("XPRA_WEBP_LOSSLESS_THRESHOLD", 75)</pre>
<pre class='cython code score-18 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_envint);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple__13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD = __pyx_t_4;
/* … */
  __pyx_tuple__13 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_LOSSLESS_THRESHOLD, __pyx_int_75);<span class='error_goto'> if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 24, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__13);
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">025</span>: cdef int SUBSAMPLING_THRESHOLD = envint("XPRA_WEBP_SUBSAMPLING_THRESHOLD", 40)</pre>
<pre class='cython code score-18 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_envint);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_tuple__14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_4 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_SUBSAMPLING_THRESHOLD = __pyx_t_4;
/* … */
  __pyx_tuple__14 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_SUBSAMPLING_THRESHOLD, __pyx_int_40);<span class='error_goto'> if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__14);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__14);
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">026</span>: assert SUBSAMPLING_THRESHOLD&lt;=LOSSLESS_THRESHOLD, "lossless threshold must be higher than subsampling threshold"</pre>
<pre class='cython code score-5 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    if (unlikely(!((__pyx_v_4xpra_6codecs_4webp_7encoder_SUBSAMPLING_THRESHOLD &lt;= __pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD) != 0))) {
      <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_kp_u_lossless_threshold_must_be_highe);
      <span class='error_goto'>__PYX_ERR(0, 26, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">027</span>: assert LOSSLESS_THRESHOLD&gt;=0 and LOSSLESS_THRESHOLD&lt;=100, "invalid lossless threshold: %i" % LOSSLESS_THRESHOLD</pre>
<pre class='cython code score-14 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    __pyx_t_6 = ((__pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD &gt;= 0) != 0);
    if (__pyx_t_6) {
    } else {
      __pyx_t_5 = __pyx_t_6;
      goto __pyx_L2_bool_binop_done;
    }
    __pyx_t_6 = ((__pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD &lt;= 0x64) != 0);
    __pyx_t_5 = __pyx_t_6;
    __pyx_L2_bool_binop_done:;
    if (unlikely(!__pyx_t_5)) {
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 27, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_invalid_lossless_threshold_i, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 27, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">028</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">029</span>: cdef inline int MIN(int a, int b):</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4xpra_6codecs_4webp_7encoder_MIN(int __pyx_v_a, int __pyx_v_b) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("MIN", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">030</span>:     if a&lt;=b:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_a &lt;= __pyx_v_b) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">031</span>:         return a</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_a;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">032</span>:     return b</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_b;
  goto __pyx_L0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">033</span>: cdef inline int MAX(int a, int b):</pre>
<pre class='cython code score-0 '>static CYTHON_INLINE int __pyx_f_4xpra_6codecs_4webp_7encoder_MAX(int __pyx_v_a, int __pyx_v_b) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("MAX", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">034</span>:     if a&gt;=b:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_a &gt;= __pyx_v_b) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">035</span>:         return a</pre>
<pre class='cython code score-0 '>    __pyx_r = __pyx_v_a;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">036</span>:     return b</pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_b;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">037</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: from libc.stdint cimport uint8_t, uint32_t, uintptr_t</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: cdef extern from *:</pre>
<pre class="cython line score-0">&#xA0;<span class="">042</span>:     ctypedef unsigned long size_t</pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: DEF WEBP_MAX_DIMENSION = 16383</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: cdef extern from "webp/encode.h":</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:     int WebPGetEncoderVersion()</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:     ctypedef int WebPImageHint</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:     # WebPImageHint:</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:     WebPImageHint WEBP_HINT_DEFAULT     #default preset</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:     WebPImageHint WEBP_HINT_PICTURE     #digital picture, like portrait, inner shot</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:     WebPImageHint WEBP_HINT_PHOTO       #outdoor photograph, with natural lighting</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:     WebPImageHint WEBP_HINT_GRAPH       #Discrete tone image (graph, map-tile etc).</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     ctypedef int WebPPreset</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     WebPPreset WEBP_PRESET_DEFAULT      #default preset.</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>:     WebPPreset WEBP_PRESET_PICTURE      #digital picture, like portrait, inner shot</pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:     WebPPreset WEBP_PRESET_PHOTO        #outdoor photograph, with natural lighting</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>:     WebPPreset WEBP_PRESET_DRAWING      #hand or line drawing, with high-contrast details</pre>
<pre class="cython line score-0">&#xA0;<span class="">063</span>:     WebPPreset WEBP_PRESET_ICON         #small-sized colorful images</pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:     WebPPreset WEBP_PRESET_TEXT         #text-like</pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:     ctypedef int WebPEncCSP</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:     #chroma sampling</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:     WebPEncCSP WEBP_YUV420              #4:2:0</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:     WebPEncCSP WEBP_YUV422              #4:2:2</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:     WebPEncCSP WEBP_YUV444              #4:4:4</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:     WebPEncCSP WEBP_YUV400              #grayscale</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:     WebPEncCSP WEBP_CSP_UV_MASK         #bit-mask to get the UV sampling factors</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:     WebPEncCSP WEBP_YUV420A</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:     WebPEncCSP WEBP_YUV422A</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:     WebPEncCSP WEBP_YUV444A</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:     WebPEncCSP WEBP_YUV400A             #grayscale + alpha</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:     WebPEncCSP WEBP_CSP_ALPHA_BIT       #bit that is set if alpha is present</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:     ctypedef int WebPEncodingError</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:     WebPEncodingError VP8_ENC_OK</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:     WebPEncodingError VP8_ENC_ERROR_OUT_OF_MEMORY</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:     WebPEncodingError VP8_ENC_ERROR_BITSTREAM_OUT_OF_MEMORY</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:     WebPEncodingError VP8_ENC_ERROR_NULL_PARAMETER</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>:     WebPEncodingError VP8_ENC_ERROR_INVALID_CONFIGURATION</pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:     WebPEncodingError VP8_ENC_ERROR_BAD_DIMENSION</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:     WebPEncodingError VP8_ENC_ERROR_PARTITION0_OVERFLOW</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:     WebPEncodingError VP8_ENC_ERROR_PARTITION_OVERFLOW</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:     WebPEncodingError VP8_ENC_ERROR_BAD_WRITE</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>:     WebPEncodingError VP8_ENC_ERROR_FILE_TOO_BIG</pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:     WebPEncodingError VP8_ENC_ERROR_USER_ABORT</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>:     WebPEncodingError VP8_ENC_ERROR_LAST</pre>
<pre class="cython line score-0">&#xA0;<span class="">092</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">093</span>:     ctypedef struct WebPConfig:</pre>
<pre class="cython line score-0">&#xA0;<span class="">094</span>:         int lossless                    #Lossless encoding (0=lossy(default), 1=lossless).</pre>
<pre class="cython line score-0">&#xA0;<span class="">095</span>:         float quality                   #between 0 (smallest file) and 100 (biggest)</pre>
<pre class="cython line score-0">&#xA0;<span class="">096</span>:         int method                      #quality/speed trade-off (0=fast, 6=slower-better)</pre>
<pre class="cython line score-0">&#xA0;<span class="">097</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">098</span>:         WebPImageHint image_hint        #Hint for image type (lossless only for now).</pre>
<pre class="cython line score-0">&#xA0;<span class="">099</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">100</span>:         #Parameters related to lossy compression only:</pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>:         int target_size                 #if non-zero, set the desired target size in bytes.</pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>:                                         #Takes precedence over the 'compression' parameter.</pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>:         float target_PSNR               #if non-zero, specifies the minimal distortion to</pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>:                                         #try to achieve. Takes precedence over target_size.</pre>
<pre class="cython line score-0">&#xA0;<span class="">105</span>:         int segments                    #maximum number of segments to use, in [1..4]</pre>
<pre class="cython line score-0">&#xA0;<span class="">106</span>:         int sns_strength                #Spatial Noise Shaping. 0=off, 100=maximum.</pre>
<pre class="cython line score-0">&#xA0;<span class="">107</span>:         int filter_strength             #range: [0 = off .. 100 = strongest]</pre>
<pre class="cython line score-0">&#xA0;<span class="">108</span>:         int filter_sharpness            #range: [0 = off .. 7 = least sharp]</pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>:         int filter_type                 #filtering type: 0 = simple, 1 = strong (only used</pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>:                                         #if filter_strength &gt; 0 or autofilter &gt; 0)</pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>:         int autofilter                  #Auto adjust filter's strength [0 = off, 1 = on]</pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>:         int alpha_compression           #Algorithm for encoding the alpha plane (0 = none,</pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>:                                         #1 compressed with WebP lossless). Default is 1.</pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>:         int alpha_filtering             #Predictive filtering method for alpha plane.</pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>:                                         #0: none, 1: fast, 2: best. Default if 1.</pre>
<pre class="cython line score-0">&#xA0;<span class="">116</span>:         int alpha_quality               #Between 0 (smallest size) and 100 (lossless).</pre>
<pre class="cython line score-0">&#xA0;<span class="">117</span>:                                         #Default is 100.</pre>
<pre class="cython line score-0">&#xA0;<span class="">118</span>:         int _pass "pass"                #number of entropy-analysis passes (in [1..10]).</pre>
<pre class="cython line score-0">&#xA0;<span class="">119</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">120</span>:         int show_compressed             #if true, export the compressed picture back.</pre>
<pre class="cython line score-0">&#xA0;<span class="">121</span>:                                         #In-loop filtering is not applied.</pre>
<pre class="cython line score-0">&#xA0;<span class="">122</span>:         int preprocessing               #preprocessing filter (0=none, 1=segment-smooth)</pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         int partitions                  #log2(number of token partitions) in [0..3]. Default</pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:                                         #is set to 0 for easier progressive decoding.</pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         int partition_limit             #quality degradation allowed to fit the 512k limit</pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:                                         #on prediction modes coding (0: no degradation,</pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:                                         #100: maximum possible degradation).</pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:         int emulate_jpeg_size           #If true, compression parameters will be remapped</pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>:                                         #to better match the expected output size from</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:                                         #JPEG compression. Generally, the output size will</pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:                                         #be similar but the degradation will be lower.</pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:         int thread_level                #If non-zero, try and use multi-threaded encoding.</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:         int low_memory                  #If set, reduce memory usage (but increase CPU use).</pre>
<pre class="cython line score-0">&#xA0;<span class="">134</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">135</span>:         int near_lossless               #Near lossless encoding [0 = max loss .. 100 = off</pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>:                                         #(default)</pre>
<pre class="cython line score-0">&#xA0;<span class="">137</span>:         int exact                       #if non-zero, preserve the exact RGB values under</pre>
<pre class="cython line score-0">&#xA0;<span class="">138</span>:                                         #transparent area. Otherwise, discard this invisible</pre>
<pre class="cython line score-0">&#xA0;<span class="">139</span>:                                         #RGB information for better compression. The default</pre>
<pre class="cython line score-0">&#xA0;<span class="">140</span>:                                         #value is 0.</pre>
<pre class="cython line score-0">&#xA0;<span class="">141</span>:         uint32_t pad[3]                 #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:     ctypedef struct WebPMemoryWriter:</pre>
<pre class="cython line score-0">&#xA0;<span class="">144</span>:         uint8_t* mem                    #final buffer (of size 'max_size', larger than 'size').</pre>
<pre class="cython line score-0">&#xA0;<span class="">145</span>:         size_t   size                   #final size</pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>:         size_t   max_size               #total capacity</pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:         uint32_t pad[1]</pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>:     ctypedef void *WebPWriterFunction</pre>
<pre class="cython line score-0">&#xA0;<span class="">150</span>:     ctypedef void *WebPProgressHook</pre>
<pre class="cython line score-0">&#xA0;<span class="">151</span>:     ctypedef void *WebPAuxStats</pre>
<pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:     ctypedef struct WebPPicture:</pre>
<pre class="cython line score-0">&#xA0;<span class="">154</span>:         #   INPUT</pre>
<pre class="cython line score-0">&#xA0;<span class="">155</span>:         # Main flag for encoder selecting between ARGB or YUV input.</pre>
<pre class="cython line score-0">&#xA0;<span class="">156</span>:         # It is recommended to use ARGB input (*argb, argb_stride) for lossless</pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>:         # compression, and YUV input (*y, *u, *v, etc.) for lossy compression</pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>:         # since these are the respective native colorspace for these formats.</pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:         int use_argb</pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:         # YUV input (mostly used for input to lossy compression)</pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>:         WebPEncCSP colorspace           #colorspace: should be YUV420 for now (=Y'CbCr).</pre>
<pre class="cython line score-0">&#xA0;<span class="">163</span>:         int width, height               #dimensions (less or equal to WEBP_MAX_DIMENSION)</pre>
<pre class="cython line score-0">&#xA0;<span class="">164</span>:         uint8_t *y</pre>
<pre class="cython line score-0">&#xA0;<span class="">165</span>:         uint8_t *u</pre>
<pre class="cython line score-0">&#xA0;<span class="">166</span>:         uint8_t *v</pre>
<pre class="cython line score-0">&#xA0;<span class="">167</span>:         int y_stride, uv_stride         #luma/chroma strides.</pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>:         uint8_t* a                      #pointer to the alpha plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">169</span>:         int a_stride                    #stride of the alpha plane</pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>:         uint32_t pad1[2]                #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:         # ARGB input (mostly used for input to lossless compression)</pre>
<pre class="cython line score-0">&#xA0;<span class="">173</span>:         uint32_t* argb                  #Pointer to argb (32 bit) plane.</pre>
<pre class="cython line score-0">&#xA0;<span class="">174</span>:         int argb_stride                 #This is stride in pixels units, not bytes.</pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>:         uint32_t pad2[3]                #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">176</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">177</span>:         #   OUTPUT</pre>
<pre class="cython line score-0">&#xA0;<span class="">178</span>:         # Byte-emission hook, to store compressed bytes as they are ready.</pre>
<pre class="cython line score-0">&#xA0;<span class="">179</span>:         WebPWriterFunction writer       #can be NULL</pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>:         void* custom_ptr                #can be used by the writer.</pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">182</span>:         # map for extra information (only for lossy compression mode)</pre>
<pre class="cython line score-0">&#xA0;<span class="">183</span>:         int extra_info_type             #1: intra type, 2: segment, 3: quant</pre>
<pre class="cython line score-0">&#xA0;<span class="">184</span>:                                         #4: intra-16 prediction mode,</pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>:                                         #5: chroma prediction mode,</pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>:                                         #6: bit cost, 7: distortion</pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>:         uint8_t* extra_info             #if not NULL, points to an array of size</pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>:                                         # ((width + 15) / 16) * ((height + 15) / 16) that</pre>
<pre class="cython line score-0">&#xA0;<span class="">189</span>:                                         #will be filled with a macroblock map, depending</pre>
<pre class="cython line score-0">&#xA0;<span class="">190</span>:                                         #on extra_info_type.</pre>
<pre class="cython line score-0">&#xA0;<span class="">191</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">192</span>:         #   STATS AND REPORTS</pre>
<pre class="cython line score-0">&#xA0;<span class="">193</span>:         # Pointer to side statistics (updated only if not NULL)</pre>
<pre class="cython line score-0">&#xA0;<span class="">194</span>:         WebPAuxStats* stats</pre>
<pre class="cython line score-0">&#xA0;<span class="">195</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">196</span>:         # Error code for the latest error encountered during encoding</pre>
<pre class="cython line score-0">&#xA0;<span class="">197</span>:         WebPEncodingError error_code</pre>
<pre class="cython line score-0">&#xA0;<span class="">198</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>:         #If not NULL, report progress during encoding.</pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>:         WebPProgressHook progress_hook</pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>:         void* user_data                 #this field is free to be set to any value and</pre>
<pre class="cython line score-0">&#xA0;<span class="">203</span>:                                         #used during callbacks (like progress-report e.g.).</pre>
<pre class="cython line score-0">&#xA0;<span class="">204</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">205</span>:         uint32_t pad3[3]                #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>:         # Unused for now: original samples (for non-YUV420 modes)</pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>:         uint8_t *u0</pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>:         uint8_t *v0</pre>
<pre class="cython line score-0">&#xA0;<span class="">210</span>:         int uv0_stride</pre>
<pre class="cython line score-0">&#xA0;<span class="">211</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:         uint32_t pad4[7]                #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>:         # PRIVATE FIELDS</pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>:         void* memory_                   #row chunk of memory for yuva planes</pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:         void* memory_argb_              #and for argb too.</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>:         void* pad5[2]                   #padding for later use</pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>:     void WebPMemoryWriterInit(WebPMemoryWriter* writer)</pre>
<pre class="cython line score-0">&#xA0;<span class="">220</span>:     int WebPMemoryWrite(const uint8_t* data, size_t data_size, const WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">221</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">222</span>:     int WebPConfigInit(WebPConfig* config)</pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>:     int WebPConfigPreset(WebPConfig* config, WebPPreset preset, float quality)</pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>:     int WebPValidateConfig(const WebPConfig* config)</pre>
<pre class="cython line score-0">&#xA0;<span class="">225</span>:     int WebPPictureInit(WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">226</span>:     void WebPPictureFree(WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:     # Colorspace conversion function to import RGB samples.</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:     # Previous buffer will be free'd, if any.</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:     # *rgb buffer should have a size of at least height * rgb_stride.</pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:     # Returns false in case of memory error.</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>:     int WebPPictureImportRGB(WebPPicture* picture, const uint8_t* rgb, int rgb_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:     # Same, but for RGBA buffer.</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>:     int WebPPictureImportRGBA(WebPPicture* picture, const uint8_t* rgba, int rgba_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:     # Same, but for RGBA buffer. Imports the RGB direct from the 32-bit format</pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:     # input buffer ignoring the alpha channel. Avoids needing to copy the data</pre>
<pre class="cython line score-0">&#xA0;<span class="">237</span>:     # to a temporary 24-bit RGB buffer to import the RGB only.</pre>
<pre class="cython line score-0">&#xA0;<span class="">238</span>:     int WebPPictureImportRGBX(WebPPicture* picture, const uint8_t* rgbx, int rgbx_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>:     # Variants of the above, but taking BGR(A|X) input.</pre>
<pre class="cython line score-0">&#xA0;<span class="">241</span>:     int WebPPictureImportBGR(WebPPicture* picture, const uint8_t* bgr, int bgr_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">242</span>:     int WebPPictureImportBGRA(WebPPicture* picture, const uint8_t* bgra, int bgra_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>:     int WebPPictureImportBGRX(WebPPicture* picture, const uint8_t* bgrx, int bgrx_stride)</pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">245</span>:     # Converts picture-&gt;argb data to the YUVA format specified by 'colorspace'.</pre>
<pre class="cython line score-0">&#xA0;<span class="">246</span>:     # Upon return, picture-&gt;use_argb is set to false. The presence of real</pre>
<pre class="cython line score-0">&#xA0;<span class="">247</span>:     # non-opaque transparent values is detected, and 'colorspace' will be</pre>
<pre class="cython line score-0">&#xA0;<span class="">248</span>:     # adjusted accordingly. Note that this method is lossy.</pre>
<pre class="cython line score-0">&#xA0;<span class="">249</span>:     # Returns false in case of error.</pre>
<pre class="cython line score-0">&#xA0;<span class="">250</span>:     int WebPPictureARGBToYUVA(WebPPicture* picture, WebPEncCSP colorspace)</pre>
<pre class="cython line score-0">&#xA0;<span class="">251</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">252</span>:     # Converts picture-&gt;yuv to picture-&gt;argb and sets picture-&gt;use_argb to true.</pre>
<pre class="cython line score-0">&#xA0;<span class="">253</span>:     # The input format must be YUV_420 or YUV_420A.</pre>
<pre class="cython line score-0">&#xA0;<span class="">254</span>:     # Note that the use of this method is discouraged if one has access to the</pre>
<pre class="cython line score-0">&#xA0;<span class="">255</span>:     # raw ARGB samples, since using YUV420 is comparatively lossy. Also, the</pre>
<pre class="cython line score-0">&#xA0;<span class="">256</span>:     # conversion from YUV420 to ARGB incurs a small loss too.</pre>
<pre class="cython line score-0">&#xA0;<span class="">257</span>:     # Returns false in case of error.</pre>
<pre class="cython line score-0">&#xA0;<span class="">258</span>:     int WebPPictureYUVAToARGB(WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">259</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">260</span>:     # Helper function: given a width x height plane of YUV(A) samples</pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>:     # (with stride 'stride'), clean-up the YUV samples under fully transparent</pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>:     # area, to help compressibility (no guarantee, though).</pre>
<pre class="cython line score-0">&#xA0;<span class="">263</span>:     void WebPCleanupTransparentArea(WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>:     # Scan the picture 'picture' for the presence of non fully opaque alpha values.</pre>
<pre class="cython line score-0">&#xA0;<span class="">266</span>:     # Returns true in such case. Otherwise returns false (indicating that the</pre>
<pre class="cython line score-0">&#xA0;<span class="">267</span>:     # alpha plane can be ignored altogether e.g.).</pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>:     int WebPPictureHasTransparency(const WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>:     # Main encoding call, after config and picture have been initialized.</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>:     # 'picture' must be less than 16384x16384 in dimension (cf WEBP_MAX_DIMENSION),</pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>:     # and the 'config' object must be a valid one.</pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:     # Returns false in case of error, true otherwise.</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:     # In case of error, picture-&gt;error_code is updated accordingly.</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:     # 'picture' can hold the source samples in both YUV(A) or ARGB input, depending</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>:     # on the value of 'picture-&gt;use_argb'. It is highly recommended to use</pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:     # the former for lossy encoding, and the latter for lossless encoding</pre>
<pre class="cython line score-0">&#xA0;<span class="">278</span>:     # (when config.lossless is true). Automatic conversion from one format to</pre>
<pre class="cython line score-0">&#xA0;<span class="">279</span>:     # another is provided but they both incur some loss.</pre>
<pre class="cython line score-0">&#xA0;<span class="">280</span>:     int WebPEncode(const WebPConfig* config, WebPPicture* picture)</pre>
<pre class="cython line score-0">&#xA0;<span class="">281</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>: ERROR_TO_NAME = {</pre>
<pre class="cython line score-0">&#xA0;<span class="">284</span>: #VP8_ENC_OK</pre>
<pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">285</span>:     VP8_ENC_ERROR_OUT_OF_MEMORY             : "memory error allocating objects",</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_OUT_OF_MEMORY);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_memory_error_allocating_objects) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">286</span>:     VP8_ENC_ERROR_BITSTREAM_OUT_OF_MEMORY   : "memory error while flushing bits",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_BITSTREAM_OUT_OF_MEMORY);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_memory_error_while_flushing_bits) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">287</span>:     VP8_ENC_ERROR_NULL_PARAMETER            : "a pointer parameter is NULL",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_NULL_PARAMETER);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 287, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_a_pointer_parameter_is_NULL) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">288</span>:     VP8_ENC_ERROR_INVALID_CONFIGURATION     : "configuration is invalid",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_INVALID_CONFIGURATION);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 288, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_configuration_is_invalid) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">289</span>:     VP8_ENC_ERROR_BAD_DIMENSION             : "picture has invalid width/height",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_BAD_DIMENSION);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 289, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_picture_has_invalid_width_height) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">290</span>:     VP8_ENC_ERROR_PARTITION0_OVERFLOW       : "partition is bigger than 512k",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_PARTITION0_OVERFLOW);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_partition_is_bigger_than_512k) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">291</span>:     VP8_ENC_ERROR_PARTITION_OVERFLOW        : "partition is bigger than 16M",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_PARTITION_OVERFLOW);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 291, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_partition_is_bigger_than_16M) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">292</span>:     VP8_ENC_ERROR_BAD_WRITE                 : "error while flushing bytes",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_BAD_WRITE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 292, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_error_while_flushing_bytes) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">293</span>:     VP8_ENC_ERROR_FILE_TOO_BIG              : "file is bigger than 4G",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_FILE_TOO_BIG);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 293, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_file_is_bigger_than_4G) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">294</span>:     VP8_ENC_ERROR_USER_ABORT                : "abort request by user",</pre>
<pre class='cython code score-14 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(VP8_ENC_ERROR_USER_ABORT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 294, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_kp_u_abort_request_by_user) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 285, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ERROR_TO_NAME, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 283, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">295</span>:     }</pre>
<pre class="cython line score-0">&#xA0;<span class="">296</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: PRESETS = {</pre>
<pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">298</span>:     WEBP_PRESET_DEFAULT      : "default",</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_DEFAULT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_default) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">299</span>:     WEBP_PRESET_PICTURE      : "picture",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_PICTURE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 299, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_picture) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">300</span>:     WEBP_PRESET_PHOTO        : "photo",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_PHOTO);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 300, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_photo) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">301</span>:     WEBP_PRESET_DRAWING      : "drawing",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_DRAWING);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 301, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_drawing) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">302</span>:     WEBP_PRESET_ICON         : "icon",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_ICON);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_icon) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">303</span>:     WEBP_PRESET_TEXT         : "text",</pre>
<pre class='cython code score-14 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_TEXT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_text) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 298, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_PRESETS, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 297, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">304</span>:     }</pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">305</span>: PRESET_NAME_TO_CONSTANT = {}</pre>
<pre class='cython code score-11 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 305, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_PRESET_NAME_TO_CONSTANT, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 305, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-21" onclick='toggleDiv(this)'>+<span class="">306</span>: for k,v in PRESETS.items():</pre>
<pre class='cython code score-21 '>  __pyx_t_7 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESETS);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (unlikely(__pyx_t_2 == Py_None)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "items");
    <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
  }
  __pyx_t_9 = __Pyx_dict_iterator(__pyx_t_2, 0, __pyx_n_s_items, (&amp;__pyx_t_8), (&amp;__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 306, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  __pyx_t_3 = __pyx_t_9;
  __pyx_t_9 = 0;
  while (1) {
    __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_8, &amp;__pyx_t_7, &amp;__pyx_t_9, &amp;__pyx_t_2, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_10 == 0)) break;
    if (unlikely(__pyx_t_10 == -1)) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_k, __pyx_t_9) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_v, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 306, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-15" onclick='toggleDiv(this)'>+<span class="">307</span>:     PRESET_NAME_TO_CONSTANT[v] = k</pre>
<pre class='cython code score-15 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 307, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESET_NAME_TO_CONSTANT);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 307, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 307, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_t_9, __pyx_t_11, __pyx_t_2) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 307, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">308</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">309</span>: CONTENT_TYPE_PRESET = {</pre>
<pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">310</span>:     "picture"   : WEBP_PRESET_PICTURE,</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_PICTURE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_u_picture, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">311</span>:     "text"      : WEBP_PRESET_TEXT,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_TEXT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_u_text, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">312</span>:     "browser"   : WEBP_PRESET_TEXT,</pre>
<pre class='cython code score-14 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_TEXT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 312, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_u_browser, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 310, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_CONTENT_TYPE_PRESET, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 309, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">313</span>:     }</pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: IMAGE_HINT = {</pre>
<pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">316</span>:     WEBP_HINT_DEFAULT     : "default",</pre>
<pre class='cython code score-13 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_DEFAULT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_default) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">317</span>:     WEBP_HINT_PICTURE     : "picture",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_PICTURE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 317, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_picture) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">318</span>:     WEBP_HINT_PHOTO       : "photo",</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_PHOTO);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 318, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_photo) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">319</span>:     WEBP_HINT_GRAPH       : "graph",</pre>
<pre class='cython code score-14 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_GRAPH);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 319, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_t_2, __pyx_n_u_graph) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 316, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_IMAGE_HINT, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">320</span>:     }</pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">321</span>: HINT_NAME_TO_CONSTANT = {}</pre>
<pre class='cython code score-11 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_HINT_NAME_TO_CONSTANT, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 321, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-21" onclick='toggleDiv(this)'>+<span class="">322</span>: for k,v in IMAGE_HINT.items():</pre>
<pre class='cython code score-21 '>  __pyx_t_8 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 322, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (unlikely(__pyx_t_2 == Py_None)) {
    <span class='py_c_api'>PyErr_Format</span>(PyExc_AttributeError, "'NoneType' object has no attribute '%s'", "items");
    <span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>
  }
  __pyx_t_11 = __Pyx_dict_iterator(__pyx_t_2, 0, __pyx_n_s_items, (&amp;__pyx_t_7), (&amp;__pyx_t_4));<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 322, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  __pyx_t_3 = __pyx_t_11;
  __pyx_t_11 = 0;
  while (1) {
    __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_7, &amp;__pyx_t_8, &amp;__pyx_t_11, &amp;__pyx_t_2, NULL, __pyx_t_4);
    if (unlikely(__pyx_t_10 == 0)) break;
    if (unlikely(__pyx_t_10 == -1)) <span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_k, __pyx_t_11) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_v, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 322, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-15" onclick='toggleDiv(this)'>+<span class="">323</span>:     HINT_NAME_TO_CONSTANT[v] = k</pre>
<pre class='cython code score-15 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_HINT_NAME_TO_CONSTANT);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_v);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 323, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (unlikely(<span class='py_c_api'>PyObject_SetItem</span>(__pyx_t_11, __pyx_t_9, __pyx_t_2) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 323, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">324</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">325</span>: CONTENT_TYPE_HINT = {</pre>
<pre class="cython line score-19" onclick='toggleDiv(this)'>+<span class="">326</span>:     "picture"   : WEBP_HINT_PICTURE,</pre>
<pre class='cython code score-19 '>  __pyx_t_3 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_PICTURE);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 326, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_u_picture, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 326, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_CONTENT_TYPE_HINT, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 325, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">327</span>:     }</pre>
<pre class="cython line score-0">&#xA0;<span class="">328</span>: </pre>
<pre class="cython line score-89" onclick='toggleDiv(this)'>+<span class="">329</span>: cdef WebPImageHint DEFAULT_IMAGE_HINT = HINT_NAME_TO_CONSTANT.get(os.environ.get("XPRA_WEBP_IMAGE_HINT", "graph").lower(), WEBP_HINT_GRAPH)</pre>
<pre class='cython code score-89 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_HINT_NAME_TO_CONSTANT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_os);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_environ);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_11, __pyx_tuple__15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_12, __pyx_n_s_lower);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_12 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  if (__pyx_t_12) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_12);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(WEBP_HINT_GRAPH);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_12 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_9))) {
    __pyx_t_12 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_9);
    if (likely(__pyx_t_12)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_12, __pyx_t_2, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_9)) {
    PyObject *__pyx_temp[3] = {__pyx_t_12, __pyx_t_2, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_9, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  {
    __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    if (__pyx_t_12) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_12); __pyx_t_12 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_4, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_4, __pyx_t_11);
    __pyx_t_2 = 0;
    __pyx_t_11 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_As_WebPImageHint</span>(__pyx_t_3); if (unlikely((__pyx_t_14 == ((WebPImageHint)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_IMAGE_HINT = __pyx_t_14;
/* … */
  __pyx_tuple__15 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_IMAGE_HINT, __pyx_n_u_graph);<span class='error_goto'> if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__15);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__15);
</pre><pre class="cython line score-89" onclick='toggleDiv(this)'>+<span class="">330</span>: cdef WebPPreset DEFAULT_PRESET = PRESET_NAME_TO_CONSTANT.get(os.environ.get("XPRA_WEBP_PRESET", "text").lower(), WEBP_PRESET_TEXT)</pre>
<pre class='cython code score-89 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESET_NAME_TO_CONSTANT);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_os);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_environ);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_11, __pyx_tuple__16, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_lower);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  if (__pyx_t_2) {
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_TEXT);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_13)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_9, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_13)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_t_9, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  {
    __pyx_t_12 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    if (__pyx_t_2) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 0+__pyx_t_4, __pyx_t_9);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_12, 1+__pyx_t_4, __pyx_t_11);
    __pyx_t_9 = 0;
    __pyx_t_11 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_12, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_As_WebPPreset</span>(__pyx_t_3); if (unlikely((__pyx_t_15 == ((WebPPreset)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_PRESET = __pyx_t_15;
/* … */
  __pyx_tuple__16 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_PRESET, __pyx_n_u_text);<span class='error_goto'> if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__16);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__16);
</pre><pre class="cython line score-89" onclick='toggleDiv(this)'>+<span class="">331</span>: cdef WebPPreset PRESET_SMALL = PRESET_NAME_TO_CONSTANT.get(os.environ.get("XPRA_WEBP_PRESET_SMALL", "icon").lower(), WEBP_PRESET_ICON)</pre>
<pre class='cython code score-89 '>  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESET_NAME_TO_CONSTANT);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_os);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_11, __pyx_n_s_environ);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_11, __pyx_tuple__17, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_lower);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_11))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_11);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_11);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_11, function);
    }
  }
  if (__pyx_t_9) {
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_11, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  } else {
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_11);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(WEBP_PRESET_ICON);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
  __pyx_t_9 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_12))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_12);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_12, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_12)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_13, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_12)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_13, __pyx_t_11};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_12, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  } else
  #endif
  {
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0+__pyx_t_4, __pyx_t_13);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1+__pyx_t_4, __pyx_t_11);
    __pyx_t_13 = 0;
    __pyx_t_11 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_12, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_As_WebPPreset</span>(__pyx_t_3); if (unlikely((__pyx_t_15 == ((WebPPreset)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_4xpra_6codecs_4webp_7encoder_PRESET_SMALL = __pyx_t_15;
/* … */
  __pyx_tuple__17 = <span class='py_c_api'>PyTuple_Pack</span>(2, __pyx_n_u_XPRA_WEBP_PRESET_SMALL, __pyx_n_u_icon);<span class='error_goto'> if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 331, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__17);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__17);
</pre><pre class="cython line score-0">&#xA0;<span class="">332</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">334</span>: def get_encodings():</pre>
<pre class='cython code score-11 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_1get_encodings(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_1get_encodings = {"get_encodings", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_1get_encodings, METH_NOARGS, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_1get_encodings(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_encodings (wrapper)", 0);
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_get_encodings(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_get_encodings(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_encodings", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.get_encodings", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_1get_encodings, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_get_encodings, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_codeobj__18 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 0, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_xpra_codecs_webp_encoder_pyx, __pyx_n_s_get_encodings, 334, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">335</span>:     return ["webp"]</pre>
<pre class='cython code score-8 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_webp);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_webp);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_u_webp);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">336</span>: </pre>
<pre class="cython line score-20" onclick='toggleDiv(this)'>+<span class="">337</span>: def get_version():</pre>
<pre class='cython code score-20 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_3get_version(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_3get_version = {"get_version", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_3get_version, METH_NOARGS, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_3get_version(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_version (wrapper)", 0);
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_2get_version(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_2get_version(CYTHON_UNUSED PyObject *__pyx_self) {
  int __pyx_v_version;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_version", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.get_version", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__19 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_s_version);<span class='error_goto'> if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 337, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__19);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__19);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_3get_version, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 337, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_get_version, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 337, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__20 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 1, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__19, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_xpra_codecs_webp_encoder_pyx, __pyx_n_s_get_version, 337, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 337, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">338</span>:     cdef int version = WebPGetEncoderVersion()</pre>
<pre class='cython code score-0 '>  __pyx_v_version = WebPGetEncoderVersion();
</pre><pre class="cython line score-43" onclick='toggleDiv(this)'>+<span class="">339</span>:     log("WebPGetEncoderVersion()=%#x", version)</pre>
<pre class='cython code score-43 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_version);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_WebPGetEncoderVersion_x, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_kp_u_WebPGetEncoderVersion_x, __pyx_t_3};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    if (__pyx_t_4) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_WebPGetEncoderVersion_x);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_WebPGetEncoderVersion_x);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_5, __pyx_kp_u_WebPGetEncoderVersion_x);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_5, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 339, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-15" onclick='toggleDiv(this)'>+<span class="">340</span>:     return (version &gt;&gt; 16) &amp; 0xff, (version &gt;&gt; 8) &amp; 0xff, version &amp; 0xff</pre>
<pre class='cython code score-15 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(((__pyx_v_version &gt;&gt; 16) &amp; 0xff));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(((__pyx_v_version &gt;&gt; 8) &amp; 0xff));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_version &amp; 0xff));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 340, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 2, __pyx_t_6);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_6 = 0;
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">341</span>: </pre>
<pre class="cython line score-14" onclick='toggleDiv(this)'>+<span class="">342</span>: def get_info():</pre>
<pre class='cython code score-14 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_5get_info(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_5get_info = {"get_info", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_5get_info, METH_NOARGS, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_5get_info(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_info (wrapper)", 0);
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_4get_info(__pyx_self);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_4get_info(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_info", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.get_info", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_5get_info, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 342, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_get_info, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 342, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_codeobj__21 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(0, 0, 0, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_xpra_codecs_webp_encoder_pyx, __pyx_n_s_get_info, 342, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 342, __pyx_L1_error)</span>
</pre><pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">343</span>:     return  {</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
</pre><pre class="cython line score-29" onclick='toggleDiv(this)'>+<span class="">344</span>:             "version"       : get_version(),</pre>
<pre class='cython code score-29 '>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_get_version);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 344, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 344, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_version, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-24" onclick='toggleDiv(this)'>+<span class="">345</span>:             "encodings"     : get_encodings(),</pre>
<pre class='cython code score-24 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_get_encodings);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_encodings, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">346</span>:             "threading"     : bool(WEBP_THREADING),</pre>
<pre class='cython code score-13 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_WEBP_THREADING);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 346, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 346, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyBool_FromLong</span>((!(!__pyx_t_5)));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 346, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_threading, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">347</span>:             "image-hint"    : DEFAULT_IMAGE_HINT,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 347, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_image_hint, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-27" onclick='toggleDiv(this)'>+<span class="">348</span>:             "image-hints"   : IMAGE_HINT.values(),</pre>
<pre class='cython code score-27 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 348, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_values);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 348, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 348, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 348, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_image_hints, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">349</span>:             "preset"        : DEFAULT_PRESET,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_PRESET);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_preset, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">350</span>:             "preset-small"  : PRESET_SMALL,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_PRESET_SMALL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 350, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_kp_u_preset_small, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-27" onclick='toggleDiv(this)'>+<span class="">351</span>:             "presets"       : PRESETS.values(),</pre>
<pre class='cython code score-27 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESETS);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_values);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  if (__pyx_t_4) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_presets, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 344, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:             }</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-31" onclick='toggleDiv(this)'>+<span class="">354</span>: def webp_check(int ret):</pre>
<pre class='cython code score-31 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_7webp_check(PyObject *__pyx_self, PyObject *__pyx_arg_ret); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_7webp_check = {"webp_check", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_7webp_check, METH_O, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_7webp_check(PyObject *__pyx_self, PyObject *__pyx_arg_ret) {
  int __pyx_v_ret;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("webp_check (wrapper)", 0);
  assert(__pyx_arg_ret); {
    __pyx_v_ret = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_arg_ret); if (unlikely((__pyx_v_ret == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.webp_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_6webp_check(__pyx_self, ((int)__pyx_v_ret));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_6webp_check(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_ret) {
  PyObject *__pyx_v_err = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("webp_check", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.webp_check", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_err);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__22 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_ret, __pyx_n_s_ret, __pyx_n_s_err);<span class='error_goto'> if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__22);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__22);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_7webp_check, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_webp_check, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__23 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__22, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_xpra_codecs_webp_encoder_pyx, __pyx_n_s_webp_check, 354, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__23)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">355</span>:     if ret==0:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_ret == 0) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">356</span>:         return</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-48" onclick='toggleDiv(this)'>+<span class="">357</span>:     err = ERROR_TO_NAME.get(ret, ret)</pre>
<pre class='cython code score-48 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_ERROR_TO_NAME);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ret);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ret);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_6) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_5);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_err = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-17" onclick='toggleDiv(this)'>+<span class="">358</span>:     raise Exception("error: %s" % err)</pre>
<pre class='cython code score-17 '>  __pyx_t_2 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_error_s, __pyx_v_err);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='error_goto'>__PYX_ERR(0, 358, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">359</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">360</span>: cdef float fclamp(int v):</pre>
<pre class='cython code score-0 '>static float __pyx_f_4xpra_6codecs_4webp_7encoder_fclamp(int __pyx_v_v) {
  float __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("fclamp", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">361</span>:     if v&lt;0:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_v &lt; 0) != 0);
  if (__pyx_t_1) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">362</span>:         v = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_v = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">363</span>:     elif v&gt;100:</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_v &gt; 0x64) != 0);
  if (__pyx_t_1) {
/* … */
  }
  __pyx_L3:;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">364</span>:         v = 100</pre>
<pre class='cython code score-0 '>    __pyx_v_v = 0x64;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">365</span>:     return &lt;float&gt; v</pre>
<pre class='cython code score-0 '>  __pyx_r = ((float)__pyx_v_v);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">366</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">367</span>: </pre>
<pre class="cython line score-9" onclick='toggleDiv(this)'>+<span class="">368</span>: cdef get_config_info(WebPConfig *config):</pre>
<pre class='cython code score-9 '>static PyObject *__pyx_f_4xpra_6codecs_4webp_7encoder_get_config_info(WebPConfig *__pyx_v_config) {
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get_config_info", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.get_config_info", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-1" onclick='toggleDiv(this)'>+<span class="">369</span>:     return {</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
</pre><pre class="cython line score-13" onclick='toggleDiv(this)'>+<span class="">370</span>:         "lossless"          : config.lossless,</pre>
<pre class='cython code score-13 '>  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;lossless);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_lossless, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">371</span>:         "method"            : config.method,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;method);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 371, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_method, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-54" onclick='toggleDiv(this)'>+<span class="">372</span>:         "image_hint"        : IMAGE_HINT.get(config.image_hint, config.image_hint),</pre>
<pre class='cython code score-54 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_config-&gt;image_hint);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_config-&gt;image_hint);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[3] = {__pyx_t_6, __pyx_t_3, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_7, 2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_6) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_t_5);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_image_hint_2, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">373</span>:         "target_size"       : config.target_size,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;target_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 373, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_target_size, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">374</span>:         "target_PSNR"       : config.target_PSNR,</pre>
<pre class='cython code score-11 '>  __pyx_t_2 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_config-&gt;target_PSNR);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_target_PSNR, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">375</span>:         "segments"          : config.segments,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;segments);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 375, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_segments, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">376</span>:         "sns_strength"      : config.sns_strength,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;sns_strength);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_sns_strength, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">377</span>:         "filter_strength"   : config.filter_strength,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;filter_strength);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 377, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_filter_strength, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">378</span>:         "filter_sharpness"  : config.filter_sharpness,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;filter_sharpness);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_filter_sharpness, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">379</span>:         "filter_type"       : config.filter_type,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;filter_type);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_filter_type, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">380</span>:         "autofilter"        : config.autofilter,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;autofilter);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 380, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_autofilter, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">381</span>:         "alpha_compression" : config.alpha_compression,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;alpha_compression);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_alpha_compression, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">382</span>:         "alpha_filtering"   : config.alpha_filtering,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;alpha_filtering);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 382, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_alpha_filtering, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">383</span>:         "alpha_quality"     : config.alpha_quality,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;alpha_quality);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 383, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_alpha_quality, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">384</span>:         "pass"              : config._pass,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;pass);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_pass, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">385</span>:         "show_compressed"   : config.show_compressed,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;show_compressed);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 385, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_show_compressed, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">386</span>:         "preprocessing"     : config.preprocessing,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;preprocessing);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_preprocessing, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">387</span>:         "partitions"        : config.partitions,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;partitions);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 387, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_partitions, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">388</span>:         "partition_limit"   : config.partition_limit,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;partition_limit);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 388, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_partition_limit, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">389</span>:         "emulate_jpeg_size" : config.emulate_jpeg_size,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;emulate_jpeg_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 389, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_emulate_jpeg_size, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">390</span>:         "thread_level"      : config.thread_level,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;thread_level);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_thread_level, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">391</span>:         "low_memory"        : config.low_memory,</pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config-&gt;low_memory);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 391, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_u_low_memory, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 370, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">392</span>:         }</pre>
<pre class="cython line score-0">&#xA0;<span class="">393</span>: </pre>
<pre class="cython line score-98" onclick='toggleDiv(this)'>+<span class="">394</span>: def encode(image, int quality=50, int speed=50, supports_alpha=False, content_type=""):</pre>
<pre class='cython code score-98 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_9encode(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_9encode = {"encode", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_9encode, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_9encode(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_image = 0;
  int __pyx_v_quality;
  int __pyx_v_speed;
  PyObject *__pyx_v_supports_alpha = 0;
  PyObject *__pyx_v_content_type = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("encode (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_image,&amp;__pyx_n_s_quality,&amp;__pyx_n_s_speed,&amp;__pyx_n_s_supports_alpha,&amp;__pyx_n_s_content_type,0};
    PyObject* values[5] = {0,0,0,0,0};
    values[3] = ((PyObject *)Py_False);
    values[4] = ((PyObject *)__pyx_kp_u_);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_image)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_quality);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_speed);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_supports_alpha);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_content_type);
          if (value) { values[4] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "encode") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_image = values[0];
    if (values[1]) {
      __pyx_v_quality = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_quality == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L3_error)</span>
    } else {
      __pyx_v_quality = ((int)50);
    }
    if (values[2]) {
      __pyx_v_speed = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[2]); if (unlikely((__pyx_v_speed == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L3_error)</span>
    } else {
      __pyx_v_speed = ((int)50);
    }
    __pyx_v_supports_alpha = values[3];
    __pyx_v_content_type = values[4];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("encode", 0, 1, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.encode", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_8encode(__pyx_self, __pyx_v_image, __pyx_v_quality, __pyx_v_speed, __pyx_v_supports_alpha, __pyx_v_content_type);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_8encode(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_image, int __pyx_v_quality, int __pyx_v_speed, PyObject *__pyx_v_supports_alpha, PyObject *__pyx_v_content_type) {
  PyObject *__pyx_v_pixel_format = NULL;
  unsigned int __pyx_v_width;
  unsigned int __pyx_v_height;
  unsigned int __pyx_v_stride;
  unsigned int __pyx_v_Bpp;
  PyObject *__pyx_v_pixels = NULL;
  uint8_t *__pyx_v_pic_buf;
  Py_ssize_t __pyx_v_pic_buf_len;
  WebPConfig __pyx_v_config;
  WebPPreset __pyx_v_preset;
  WebPImageHint __pyx_v_image_hint;
  int __pyx_v_ret;
  int __pyx_v_size;
  int __pyx_v_threshold_delta;
  int __pyx_v_i;
  int __pyx_v_alpha_int;
  int __pyx_v_use_argb;
  PyObject *__pyx_v_info = NULL;
  WebPPicture __pyx_v_pic;
  PyObject *__pyx_v_client_options = NULL;
  WebPMemoryWriter __pyx_v_memory_writer;
  PyObject *__pyx_v_cdata = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("encode", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_15);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_17);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_21);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.encode", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pixel_format);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pixels);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_info);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_client_options);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_cdata);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__24 = <span class='py_c_api'>PyTuple_Pack</span>(27, __pyx_n_s_image, __pyx_n_s_quality, __pyx_n_s_speed, __pyx_n_s_supports_alpha, __pyx_n_s_content_type, __pyx_n_s_pixel_format, __pyx_n_s_width, __pyx_n_s_height, __pyx_n_s_stride, __pyx_n_s_Bpp, __pyx_n_s_pixels, __pyx_n_s_pic_buf, __pyx_n_s_pic_buf_len, __pyx_n_s_config, __pyx_n_s_preset, __pyx_n_s_image_hint_2, __pyx_n_s_ret, __pyx_n_s_size, __pyx_n_s_threshold_delta, __pyx_n_s_i, __pyx_n_s_alpha_int, __pyx_n_s_use_argb, __pyx_n_s_info, __pyx_n_s_pic, __pyx_n_s_client_options, __pyx_n_s_memory_writer, __pyx_n_s_cdata);<span class='error_goto'> if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 394, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__24);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__24);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_9encode, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 394, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_encode, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 394, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_codeobj__25 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 27, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_xpra_codecs_webp_encoder_pyx, __pyx_n_s_encode, 394, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 394, __pyx_L1_error)</span>
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">395</span>:     pixel_format = image.get_pixel_format()</pre>
<pre class='cython code score-18 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_get_pixel_format);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 395, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_pixel_format = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">396</span>:     if pixel_format not in ("RGBX", "RGBA", "BGRX", "BGRA"):</pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_pixel_format);
  __pyx_t_1 = __pyx_v_pixel_format;
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_RGBX, Py_NE)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
  if (__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_RGBA, Py_NE)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
  if (__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_BGRX, Py_NE)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
  if (__pyx_t_5) {
  } else {
    __pyx_t_4 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_5 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_t_1, __pyx_n_u_BGRA, Py_NE)); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 396, __pyx_L1_error)</span>
  __pyx_t_4 = __pyx_t_5;
  __pyx_L4_bool_binop_done:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = (__pyx_t_4 != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-17" onclick='toggleDiv(this)'>+<span class="">397</span>:         raise Exception("unsupported pixel format %s" % pixel_format)</pre>
<pre class='cython code score-17 '>    __pyx_t_1 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_unsupported_pixel_format_s, __pyx_v_pixel_format);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 397, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 397, __pyx_L1_error)</span>
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">398</span>:     cdef unsigned int width = image.get_width()</pre>
<pre class='cython code score-26 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_get_width);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(__pyx_t_1); if (unlikely((__pyx_t_6 == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 398, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_width = __pyx_t_6;
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">399</span>:     cdef unsigned int height = image.get_height()</pre>
<pre class='cython code score-26 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_get_height);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 399, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(__pyx_t_1); if (unlikely((__pyx_t_6 == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 399, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_height = __pyx_t_6;
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">400</span>:     cdef unsigned int stride = image.get_rowstride()</pre>
<pre class='cython code score-26 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_get_rowstride);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  if (__pyx_t_3) {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else {
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_unsigned_int</span>(__pyx_t_1); if (unlikely((__pyx_t_6 == (unsigned int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 400, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_stride = __pyx_t_6;
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">401</span>:     cdef unsigned int Bpp = len(pixel_format)</pre>
<pre class='cython code score-5 '>  __pyx_t_7 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_pixel_format);<span class='error_goto'> if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 401, __pyx_L1_error)</span>
  __pyx_v_Bpp = __pyx_t_7;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">402</span>:     if width&gt;WEBP_MAX_DIMENSION or height&gt;WEBP_MAX_DIMENSION:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_width &gt; 0x3FFF) != 0);
  if (!__pyx_t_4) {
  } else {
    __pyx_t_5 = __pyx_t_4;
    goto __pyx_L9_bool_binop_done;
  }
  __pyx_t_4 = ((__pyx_v_height &gt; 0x3FFF) != 0);
  __pyx_t_5 = __pyx_t_4;
  __pyx_L9_bool_binop_done:;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-29" onclick='toggleDiv(this)'>+<span class="">403</span>:         raise Exception("this image is too big for webp: %ix%i" % (width, height))</pre>
<pre class='cython code score-29 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(__pyx_v_width);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(__pyx_v_height);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_t_2);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_this_image_is_too_big_for_webp_i, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 403, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 403, __pyx_L1_error)</span>
</pre><pre class="cython line score-18" onclick='toggleDiv(this)'>+<span class="">404</span>:     pixels = image.get_pixels()</pre>
<pre class='cython code score-18 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_image, __pyx_n_s_get_pixels);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  if (__pyx_t_1) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
  }
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_pixels = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">405</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>:     cdef uint8_t *pic_buf</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">407</span>:     cdef Py_ssize_t pic_buf_len = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_pic_buf_len = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">408</span>:     cdef WebPConfig config</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">409</span>:     cdef WebPPreset preset = DEFAULT_PRESET</pre>
<pre class='cython code score-0 '>  __pyx_v_preset = __pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_PRESET;
</pre><pre class="cython line score-0">&#xA0;<span class="">410</span>:     #only use icon for small squarish rectangles</pre>
<pre class="cython line score-17" onclick='toggleDiv(this)'>+<span class="">411</span>:     if width*height&lt;=2304 and abs(width-height)&lt;=16:</pre>
<pre class='cython code score-17 '>  __pyx_t_4 = (((__pyx_v_width * __pyx_v_height) &lt;= 0x900) != 0);
  if (__pyx_t_4) {
  } else {
    __pyx_t_5 = __pyx_t_4;
    goto __pyx_L12_bool_binop_done;
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>((__pyx_v_width - __pyx_v_height));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyNumber_Absolute</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_int_16, Py_LE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_4 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 411, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_t_4;
  __pyx_L12_bool_binop_done:;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">412</span>:         preset = PRESET_SMALL</pre>
<pre class='cython code score-0 '>    __pyx_v_preset = __pyx_v_4xpra_6codecs_4webp_7encoder_PRESET_SMALL;
</pre><pre class="cython line score-53" onclick='toggleDiv(this)'>+<span class="">413</span>:     preset = CONTENT_TYPE_PRESET.get(content_type, preset)</pre>
<pre class='cython code score-53 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_CONTENT_TYPE_PRESET);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(__pyx_v_preset);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_8 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_8 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_v_content_type, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[3] = {__pyx_t_8, __pyx_v_content_type, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    if (__pyx_t_8) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_8); __pyx_t_8 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_content_type);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_9, __pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_9, __pyx_t_3);
    __pyx_t_3 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 413, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_As_WebPPreset</span>(__pyx_t_2); if (unlikely((__pyx_t_11 == ((WebPPreset)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 413, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_preset = __pyx_t_11;
</pre><pre class="cython line score-53" onclick='toggleDiv(this)'>+<span class="">414</span>:     cdef WebPImageHint image_hint = CONTENT_TYPE_HINT.get(content_type, DEFAULT_IMAGE_HINT)</pre>
<pre class='cython code score-53 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_CONTENT_TYPE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_4xpra_6codecs_4webp_7encoder_DEFAULT_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_content_type, __pyx_t_1};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_content_type, __pyx_t_1};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else
  #endif
  {
    __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_content_type);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_9, __pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_9, __pyx_t_1);
    __pyx_t_1 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_As_WebPImageHint</span>(__pyx_t_2); if (unlikely((__pyx_t_12 == ((WebPImageHint)-1)) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 414, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_image_hint = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">415</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">416</span>:     cdef int ret = object_as_buffer(pixels, &lt;const void**&gt; &amp;pic_buf, &amp;pic_buf_len)</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = __pyx_f_4xpra_7buffers_6membuf_object_as_buffer(__pyx_v_pixels, ((void const **)(&amp;__pyx_v_pic_buf)), (&amp;__pyx_v_pic_buf_len));
</pre><pre class="cython line score-22" onclick='toggleDiv(this)'>+<span class="">417</span>:     assert ret==0, "failed to get buffer from pixel object: %s (returned %s)" % (type(pixels), ret)</pre>
<pre class='cython code score-22 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    if (unlikely(!((__pyx_v_ret == 0) != 0))) {
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ret);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 417, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 417, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)Py_TYPE(__pyx_v_pixels)));
      <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)Py_TYPE(__pyx_v_pixels)));
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, ((PyObject *)Py_TYPE(__pyx_v_pixels)));
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1, __pyx_t_2);
      __pyx_t_2 = 0;
      __pyx_t_2 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_failed_to_get_buffer_from_pixel, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 417, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='error_goto'>__PYX_ERR(0, 417, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-59" onclick='toggleDiv(this)'>+<span class="">418</span>:     log("webp.compress(%s, %i, %i, %s, %s) buf=%#x", image, width, height, supports_alpha, content_type, &lt;uintptr_t&gt; pic_buf)</pre>
<pre class='cython code score-59 '>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(__pyx_v_width);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_unsigned_int</span>(__pyx_v_height);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(((uintptr_t)__pyx_v_pic_buf));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_13 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_13)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[8] = {__pyx_t_13, __pyx_kp_u_webp_compress_s_i_i_s_s_buf_x, __pyx_v_image, __pyx_t_8, __pyx_t_1, __pyx_v_supports_alpha, __pyx_v_content_type, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 7+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[8] = {__pyx_t_13, __pyx_kp_u_webp_compress_s_i_i_s_s_buf_x, __pyx_v_image, __pyx_t_8, __pyx_t_1, __pyx_v_supports_alpha, __pyx_v_content_type, __pyx_t_3};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 7+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  } else
  #endif
  {
    __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(7+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    if (__pyx_t_13) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_13); __pyx_t_13 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_webp_compress_s_i_i_s_s_buf_x);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_webp_compress_s_i_i_s_s_buf_x);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_9, __pyx_kp_u_webp_compress_s_i_i_s_s_buf_x);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_image);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_image);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_9, __pyx_v_image);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2+__pyx_t_9, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 3+__pyx_t_9, __pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_supports_alpha);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_supports_alpha);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 4+__pyx_t_9, __pyx_v_supports_alpha);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_content_type);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 5+__pyx_t_9, __pyx_v_content_type);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 6+__pyx_t_9, __pyx_t_3);
    __pyx_t_8 = 0;
    __pyx_t_1 = 0;
    __pyx_t_3 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">419</span>:     cdef int size = stride * height</pre>
<pre class='cython code score-0 '>  __pyx_v_size = (__pyx_v_stride * __pyx_v_height);
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">420</span>:     assert pic_buf_len&gt;=size, "pixel buffer is too small: expected at least %s bytes but got %s" % (size, pic_buf_len)</pre>
<pre class='cython code score-26 '>  #ifndef CYTHON_WITHOUT_ASSERTIONS
  if (unlikely(!Py_OptimizeFlag)) {
    if (unlikely(!((__pyx_v_pic_buf_len &gt;= __pyx_v_size) != 0))) {
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_size);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_10 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_v_pic_buf_len);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_2);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1, __pyx_t_10);
      __pyx_t_2 = 0;
      __pyx_t_10 = 0;
      __pyx_t_10 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_pixel_buffer_is_too_small_expect, __pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='py_c_api'>PyErr_SetObject</span>(PyExc_AssertionError, __pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L1_error)</span>
    }
  }
  #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">421</span>: </pre>
<pre class="cython line score-28" onclick='toggleDiv(this)'>+<span class="">422</span>:     cdef int threshold_delta = -int(content_type=="text")*20</pre>
<pre class='cython code score-28 '>  __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_content_type, __pyx_n_u_text, Py_EQ); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 422, __pyx_L1_error)</span>
  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 422, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyNumber_Negative</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 422, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_14 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_10, __pyx_int_20);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 422, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_14); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 422, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_v_threshold_delta = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">423</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">424</span>:     cdef int i</pre>
<pre class="cython line score-32" onclick='toggleDiv(this)'>+<span class="">425</span>:     cdef int alpha_int = int(supports_alpha and pixel_format.find("A")&gt;=0)</pre>
<pre class='cython code score-32 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_v_supports_alpha); if (unlikely(__pyx_t_5 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 425, __pyx_L1_error)</span>
  if (__pyx_t_5) {
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_supports_alpha);
    __pyx_t_14 = __pyx_v_supports_alpha;
    goto __pyx_L14_bool_binop_done;
  }
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_pixel_format, __pyx_n_s_find);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_tuple__2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_int_0, Py_GE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
  __pyx_t_14 = __pyx_t_10;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_L14_bool_binop_done:;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_10); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_v_alpha_int = __pyx_t_9;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_u_A);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 425, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">426</span>:     cdef int use_argb = int(quality&gt;=(SUBSAMPLING_THRESHOLD+threshold_delta))</pre>
<pre class='cython code score-0 '>  __pyx_v_use_argb = ((int)(__pyx_v_quality &gt;= (__pyx_v_4xpra_6codecs_4webp_7encoder_SUBSAMPLING_THRESHOLD + __pyx_v_threshold_delta)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">427</span>:     if alpha_int==0 and Bpp==4:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_alpha_int == 0) != 0);
  if (__pyx_t_4) {
  } else {
    __pyx_t_5 = __pyx_t_4;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_4 = ((__pyx_v_Bpp == 4) != 0);
  __pyx_t_5 = __pyx_t_4;
  __pyx_L17_bool_binop_done:;
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">428</span>:         #ensure webp will not decide to encode the alpha channel</pre>
<pre class="cython line score-0">&#xA0;<span class="">429</span>:         #(this is stupid: we should be able to pass a flag instead)</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">430</span>:         i = 3</pre>
<pre class='cython code score-0 '>    __pyx_v_i = 3;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">431</span>:         if size&gt;524288:</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = ((__pyx_v_size &gt; 0x80000) != 0);
    if (__pyx_t_5) {
/* … */
      goto __pyx_L19;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">432</span>:             #enough pixels that we should release the gil:</pre>
<pre class="cython line score-4" onclick='toggleDiv(this)'>+<span class="">433</span>:             with nogil:</pre>
<pre class='cython code score-4 '>      {
          #ifdef WITH_THREAD
          PyThreadState *_save;
          Py_UNBLOCK_THREADS
          <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
          #endif
          /*try:*/ {
/* … */
          /*finally:*/ {
            /*normal exit:*/{
              #ifdef WITH_THREAD
              <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
              Py_BLOCK_THREADS
              #endif
              goto __pyx_L22;
            }
            __pyx_L22:;
          }
      }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">434</span>:                 while i&lt;size:</pre>
<pre class='cython code score-0 '>            while (1) {
              __pyx_t_5 = ((__pyx_v_i &lt; __pyx_v_size) != 0);
              if (!__pyx_t_5) break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">435</span>:                     pic_buf[i] = 0xff</pre>
<pre class='cython code score-0 '>              (__pyx_v_pic_buf[__pyx_v_i]) = 0xff;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">436</span>:                     i += 4</pre>
<pre class='cython code score-0 '>              __pyx_v_i = (__pyx_v_i + 4);
            }
          }
</pre><pre class="cython line score-0">&#xA0;<span class="">437</span>:         else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">438</span>:             while i&lt;size:</pre>
<pre class='cython code score-0 '>    /*else*/ {
      while (1) {
        __pyx_t_5 = ((__pyx_v_i &lt; __pyx_v_size) != 0);
        if (!__pyx_t_5) break;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">439</span>:                 pic_buf[i] = 0xff</pre>
<pre class='cython code score-0 '>        (__pyx_v_pic_buf[__pyx_v_i]) = 0xff;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">440</span>:                 i += 4</pre>
<pre class='cython code score-0 '>        __pyx_v_i = (__pyx_v_i + 4);
      }
    }
    __pyx_L19:;
</pre><pre class="cython line score-0">&#xA0;<span class="">441</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">442</span>:     ret = WebPConfigInit(&amp;config)</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = WebPConfigInit((&amp;__pyx_v_config));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">443</span>:     if not ret:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_ret != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">444</span>:         raise Exception("failed to initialize webp config")</pre>
<pre class='cython code score-10 '>    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_10, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='error_goto'>__PYX_ERR(0, 444, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_failed_to_initialize_webp_config);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 444, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class="cython line score-0">&#xA0;<span class="">445</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">446</span>:     ret = WebPConfigPreset(&amp;config, preset, fclamp(quality))</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = WebPConfigPreset((&amp;__pyx_v_config), __pyx_v_preset, __pyx_f_4xpra_6codecs_4webp_7encoder_fclamp(__pyx_v_quality));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">447</span>:     if not ret:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_ret != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">448</span>:         raise Exception("failed to set webp preset")</pre>
<pre class='cython code score-10 '>    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 448, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_10, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='error_goto'>__PYX_ERR(0, 448, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_failed_to_set_webp_preset);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 448, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class="cython line score-0">&#xA0;<span class="">449</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">450</span>:     #tune it:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">451</span>:     config.lossless = quality&gt;=(LOSSLESS_THRESHOLD+threshold_delta)</pre>
<pre class='cython code score-0 '>  __pyx_v_config.lossless = (__pyx_v_quality &gt;= (__pyx_v_4xpra_6codecs_4webp_7encoder_LOSSLESS_THRESHOLD + __pyx_v_threshold_delta));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">452</span>:     if config.lossless:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_config.lossless != 0);
  if (__pyx_t_5) {
/* … */
    goto __pyx_L29;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">453</span>:         #not much to gain from setting a high quality here,</pre>
<pre class="cython line score-0">&#xA0;<span class="">454</span>:         #the latency will be higher for a negligible compression gain:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">455</span>:         config.quality = fclamp(50-speed//2)</pre>
<pre class='cython code score-0 '>    __pyx_v_config.quality = __pyx_f_4xpra_6codecs_4webp_7encoder_fclamp((50 - (__pyx_v_speed / 2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">456</span>:     else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">457</span>:         #normalize quality: webp quality is much higher than jpeg's</pre>
<pre class="cython line score-0">&#xA0;<span class="">458</span>:         #so we can go lower,</pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>:         #[0,10,...,90,100] maps to:</pre>
<pre class="cython line score-0">&#xA0;<span class="">460</span>:         #[0, 3, 7, 13, 20, 29, 40, 52, 66, 82, 100]</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">461</span>:         config.quality = fclamp(((quality+10)**2//121))</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_config.quality = __pyx_f_4xpra_6codecs_4webp_7encoder_fclamp((__Pyx_pow_long((__pyx_v_quality + 10), 2) / 0x79));
  }
  __pyx_L29:;
</pre><pre class="cython line score-0">&#xA0;<span class="">462</span>:     #"method" takes values from 0 to 6,</pre>
<pre class="cython line score-0">&#xA0;<span class="">463</span>:     #but anything higher than 1 is dreadfully slow,</pre>
<pre class="cython line score-0">&#xA0;<span class="">464</span>:     #so only use method=1 when speed is already very low</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">465</span>:     config.method = int(speed&lt;10)</pre>
<pre class='cython code score-0 '>  __pyx_v_config.method = ((int)(__pyx_v_speed &lt; 10));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">466</span>:     config.alpha_compression = alpha_int</pre>
<pre class='cython code score-0 '>  __pyx_v_config.alpha_compression = __pyx_v_alpha_int;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">467</span>:     config.alpha_filtering = MAX(0, MIN(2, speed/50)) * alpha_int</pre>
<pre class='cython code score-0 '>  __pyx_v_config.alpha_filtering = (__pyx_f_4xpra_6codecs_4webp_7encoder_MAX(0, __pyx_f_4xpra_6codecs_4webp_7encoder_MIN(2, (((long)__pyx_v_speed) / 50))) * __pyx_v_alpha_int);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">468</span>:     config.alpha_quality = quality * alpha_int</pre>
<pre class='cython code score-0 '>  __pyx_v_config.alpha_quality = (__pyx_v_quality * __pyx_v_alpha_int);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">469</span>:     if config.lossless:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_config.lossless != 0);
  if (__pyx_t_5) {
/* … */
    goto __pyx_L30;
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">470</span>:         config.autofilter = 1</pre>
<pre class='cython code score-0 '>    __pyx_v_config.autofilter = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">471</span>:     else:</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">472</span>:         config.segments = 1</pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_config.segments = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">473</span>:         config.sns_strength = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_config.sns_strength = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">474</span>:         config.filter_strength = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_config.filter_strength = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">475</span>:         config.filter_sharpness = 7-quality//15</pre>
<pre class='cython code score-0 '>    __pyx_v_config.filter_sharpness = (7 - (__pyx_v_quality / 15));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">476</span>:         config.filter_type = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_config.filter_type = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">477</span>:         config.autofilter = 0</pre>
<pre class='cython code score-0 '>    __pyx_v_config.autofilter = 0;
  }
  __pyx_L30:;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">478</span>:     config._pass = MAX(1, MIN(10, (100-speed)//10))</pre>
<pre class='cython code score-0 '>  __pyx_v_config.pass = __pyx_f_4xpra_6codecs_4webp_7encoder_MAX(1, __pyx_f_4xpra_6codecs_4webp_7encoder_MIN(10, ((0x64 - __pyx_v_speed) / 10)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">479</span>:     config.preprocessing = int(speed&lt;50)</pre>
<pre class='cython code score-0 '>  __pyx_v_config.preprocessing = ((int)(__pyx_v_speed &lt; 50));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">480</span>:     config.image_hint = image_hint</pre>
<pre class='cython code score-0 '>  __pyx_v_config.image_hint = __pyx_v_image_hint;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">481</span>:     config.thread_level = WEBP_THREADING</pre>
<pre class='cython code score-0 '>  __pyx_v_config.thread_level = __pyx_v_4xpra_6codecs_4webp_7encoder_WEBP_THREADING;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">482</span>:     config.partitions = 3</pre>
<pre class='cython code score-0 '>  __pyx_v_config.partitions = 3;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">483</span>:     config.partition_limit = MAX(0, MIN(100, 100-quality))</pre>
<pre class='cython code score-0 '>  __pyx_v_config.partition_limit = __pyx_f_4xpra_6codecs_4webp_7encoder_MAX(0, __pyx_f_4xpra_6codecs_4webp_7encoder_MIN(0x64, (0x64 - __pyx_v_quality)));
</pre><pre class="cython line score-0">&#xA0;<span class="">484</span>: </pre>
<pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">485</span>:     log("webp.compress config: lossless=%-5s, quality=%3i, method=%i, alpha=%3i,%3i,%3i, preset=%-8s, image hint=%s", config.lossless, config.quality, config.method,</pre>
<pre class='cython code score-11 '>  __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config.lossless);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_config.quality);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config.method);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
</pre><pre class="cython line score-162" onclick='toggleDiv(this)'>+<span class="">486</span>:                     config.alpha_compression, config.alpha_filtering, config.alpha_quality, PRESETS.get(preset, preset), IMAGE_HINT.get(image_hint, image_hint))</pre>
<pre class='cython code score-162 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config.alpha_compression);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config.alpha_filtering);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_config.alpha_quality);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_PRESETS);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_17, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(__pyx_v_preset);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPPreset</span>(__pyx_v_preset);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  __pyx_t_20 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_18))) {
    __pyx_t_20 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_18);
    if (likely(__pyx_t_20)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_18);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_20);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_18, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_18)) {
    PyObject *__pyx_temp[3] = {__pyx_t_20, __pyx_t_17, __pyx_t_19};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_18, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_18)) {
    PyObject *__pyx_temp[3] = {__pyx_t_20, __pyx_t_17, __pyx_t_19};
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_18, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  } else
  #endif
  {
    __pyx_t_21 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
    if (__pyx_t_20) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_21, 0, __pyx_t_20); __pyx_t_20 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_21, 0+__pyx_t_9, __pyx_t_17);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_21, 1+__pyx_t_9, __pyx_t_19);
    __pyx_t_17 = 0;
    __pyx_t_19 = 0;
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_18, __pyx_t_21, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_16);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
  __pyx_t_21 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_IMAGE_HINT);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_21, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_19);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
  __pyx_t_21 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_image_hint);<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
  __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPImageHint</span>(__pyx_v_image_hint);<span class='error_goto'> if (unlikely(!__pyx_t_17)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_17);
  __pyx_t_20 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_19))) {
    __pyx_t_20 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_19);
    if (likely(__pyx_t_20)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_20);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_19, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_19)) {
    PyObject *__pyx_temp[3] = {__pyx_t_20, __pyx_t_21, __pyx_t_17};
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_19, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_19)) {
    PyObject *__pyx_temp[3] = {__pyx_t_20, __pyx_t_21, __pyx_t_17};
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_19, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_17); __pyx_t_17 = 0;
  } else
  #endif
  {
    __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    if (__pyx_t_20) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_20); __pyx_t_20 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_21);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0+__pyx_t_9, __pyx_t_21);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_17);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1+__pyx_t_9, __pyx_t_17);
    __pyx_t_21 = 0;
    __pyx_t_17 = 0;
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_19, __pyx_t_22, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 486, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
  __pyx_t_19 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_14))) {
    __pyx_t_19 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_14);
    if (likely(__pyx_t_19)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_14);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_19);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_14, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_14)) {
    PyObject *__pyx_temp[10] = {__pyx_t_19, __pyx_kp_u_webp_compress_config_lossless_5s, __pyx_t_2, __pyx_t_3, __pyx_t_1, __pyx_t_8, __pyx_t_13, __pyx_t_15, __pyx_t_16, __pyx_t_18};
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_14, __pyx_temp+1-__pyx_t_9, 9+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_14)) {
    PyObject *__pyx_temp[10] = {__pyx_t_19, __pyx_kp_u_webp_compress_config_lossless_5s, __pyx_t_2, __pyx_t_3, __pyx_t_1, __pyx_t_8, __pyx_t_13, __pyx_t_15, __pyx_t_16, __pyx_t_18};
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_14, __pyx_temp+1-__pyx_t_9, 9+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_19); __pyx_t_19 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
  } else
  #endif
  {
    __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(9+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    if (__pyx_t_19) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_19); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_19); __pyx_t_19 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_webp_compress_config_lossless_5s);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_webp_compress_config_lossless_5s);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0+__pyx_t_9, __pyx_kp_u_webp_compress_config_lossless_5s);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1+__pyx_t_9, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 2+__pyx_t_9, __pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 3+__pyx_t_9, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 4+__pyx_t_9, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 5+__pyx_t_9, __pyx_t_13);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_15);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 6+__pyx_t_9, __pyx_t_15);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 7+__pyx_t_9, __pyx_t_16);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 8+__pyx_t_9, __pyx_t_18);
    __pyx_t_2 = 0;
    __pyx_t_3 = 0;
    __pyx_t_1 = 0;
    __pyx_t_8 = 0;
    __pyx_t_13 = 0;
    __pyx_t_15 = 0;
    __pyx_t_16 = 0;
    __pyx_t_18 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_14, __pyx_t_22, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 485, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">487</span>:     ret = WebPValidateConfig(&amp;config)</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = WebPValidateConfig((&amp;__pyx_v_config));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">488</span>:     if not ret:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_ret != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">489</span>:         info = get_config_info(&amp;config)</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_f_4xpra_6codecs_4webp_7encoder_get_config_info((&amp;__pyx_v_config));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 489, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_v_info = __pyx_t_10;
    __pyx_t_10 = 0;
</pre><pre class="cython line score-17" onclick='toggleDiv(this)'>+<span class="">490</span>:         raise Exception("invalid webp configuration: %s" % info)</pre>
<pre class='cython code score-17 '>    __pyx_t_10 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_invalid_webp_configuration_s, __pyx_v_info);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_10);
    __pyx_t_10 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 490, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_10, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='error_goto'>__PYX_ERR(0, 490, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">491</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>:     cdef WebPPicture pic</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">493</span>:     ret = WebPPictureInit(&amp;pic)</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = WebPPictureInit((&amp;__pyx_v_pic));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">494</span>:     if not ret:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_ret != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">495</span>:         raise Exception("failed to initialise webp picture")</pre>
<pre class='cython code score-10 '>    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_10, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='error_goto'>__PYX_ERR(0, 495, __pyx_L1_error)</span>
/* … */
  __pyx_tuple__5 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_failed_to_initialise_webp_pictur);<span class='error_goto'> if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 495, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__5);
</pre><pre class="cython line score-0">&#xA0;<span class="">496</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>:     client_options = {</pre>
<pre class="cython line score-0">&#xA0;<span class="">498</span>:         #no need to expose speed</pre>
<pre class="cython line score-0">&#xA0;<span class="">499</span>:         #(not used for anything downstream)</pre>
<pre class="cython line score-0">&#xA0;<span class="">500</span>:         #"speed"       : speed,</pre>
<pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">501</span>:         "rgb_format"  : pixel_format,</pre>
<pre class='cython code score-10 '>  __pyx_t_10 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 501, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_10, __pyx_n_u_rgb_format, __pyx_v_pixel_format) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 501, __pyx_L1_error)</span>
  __pyx_v_client_options = ((PyObject*)__pyx_t_10);
  __pyx_t_10 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">502</span>:         }</pre>
<pre class="cython line score-0">&#xA0;<span class="">503</span>: </pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">504</span>:     memset(&amp;pic, 0, sizeof(WebPPicture))</pre>
<pre class='cython code score-0 '>  memset((&amp;__pyx_v_pic), 0, (sizeof(WebPPicture)));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">505</span>:     pic.width = width</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.width = __pyx_v_width;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">506</span>:     pic.height = height</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.height = __pyx_v_height;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">507</span>:     pic.use_argb = 1</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.use_argb = 1;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">508</span>:     pic.argb = &lt;uint32_t*&gt; pic_buf</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.argb = ((uint32_t *)__pyx_v_pic_buf);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">509</span>:     pic.argb_stride = stride//Bpp</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.argb_stride = (__pyx_v_stride / __pyx_v_Bpp);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">510</span>:     if not use_argb:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_use_argb != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">511</span>:         if WebPPictureARGBToYUVA(&amp;pic, WEBP_YUV420A):</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = (WebPPictureARGBToYUVA((&amp;__pyx_v_pic), WEBP_YUV420A) != 0);
    if (__pyx_t_5) {
/* … */
      goto __pyx_L34;
    }
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">512</span>:             client_options["subsampling"] = "YUV420P"</pre>
<pre class='cython code score-5 '>      if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_client_options, __pyx_n_u_subsampling, __pyx_n_u_YUV420P) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 512, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">513</span>:             #redundant (changed by WebPPictureARGBToYUVA):</pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>:             #pic.use_argb = 0</pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>:         else:</pre>
<pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">516</span>:             raise Exception("failed to convert picture to YUV")</pre>
<pre class='cython code score-10 '>    /*else*/ {
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_10, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='error_goto'>__PYX_ERR(0, 516, __pyx_L1_error)</span>
    }
    __pyx_L34:;
/* … */
  __pyx_tuple__6 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_kp_u_failed_to_convert_picture_to_YUV);<span class='error_goto'> if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 516, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__6);
</pre><pre class="cython line score-0">&#xA0;<span class="">517</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">518</span>:     #TODO: custom writer that over-allocates memory</pre>
<pre class="cython line score-0">&#xA0;<span class="">519</span>:     cdef WebPMemoryWriter memory_writer</pre>
<pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">520</span>:     WebPMemoryWriterInit(&amp;memory_writer)</pre>
<pre class='cython code score-0 '>  WebPMemoryWriterInit((&amp;__pyx_v_memory_writer));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">521</span>:     pic.writer = &lt;WebPWriterFunction&gt; WebPMemoryWrite</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.writer = ((WebPWriterFunction)WebPMemoryWrite);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">522</span>:     pic.custom_ptr = &lt;void*&gt; &amp;memory_writer</pre>
<pre class='cython code score-0 '>  __pyx_v_pic.custom_ptr = ((void *)(&amp;__pyx_v_memory_writer));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">523</span>:     ret = WebPEncode(&amp;config, &amp;pic)</pre>
<pre class='cython code score-0 '>  __pyx_v_ret = WebPEncode((&amp;__pyx_v_config), (&amp;__pyx_v_pic));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">524</span>:     if not ret:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((!(__pyx_v_ret != 0)) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-73" onclick='toggleDiv(this)'>+<span class="">525</span>:         raise Exception("WebPEncode failed: %s, config=%s" % (ERROR_TO_NAME.get(pic.error_code, pic.error_code), get_config_info(&amp;config)))</pre>
<pre class='cython code score-73 '>    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_ERROR_TO_NAME);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_14, __pyx_n_s_get);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(__pyx_v_pic.error_code);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_18 = <span class='pyx_c_api'>__Pyx_PyInt_From_WebPEncodingError</span>(__pyx_v_pic.error_code);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
    __pyx_t_16 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_22))) {
      __pyx_t_16 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_22);
      if (likely(__pyx_t_16)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_22);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_16);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_22, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_22)) {
      PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_t_14, __pyx_t_18};
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_22, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_22)) {
      PyObject *__pyx_temp[3] = {__pyx_t_16, __pyx_t_14, __pyx_t_18};
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_22, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_16); __pyx_t_16 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    } else
    #endif
    {
      __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
      if (__pyx_t_16) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_16); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_16); __pyx_t_16 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0+__pyx_t_9, __pyx_t_14);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1+__pyx_t_9, __pyx_t_18);
      __pyx_t_14 = 0;
      __pyx_t_18 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_22, __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
    __pyx_t_22 = __pyx_f_4xpra_6codecs_4webp_7encoder_get_config_info((&amp;__pyx_v_config));<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_10);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 1, __pyx_t_22);
    __pyx_t_10 = 0;
    __pyx_t_22 = 0;
    __pyx_t_22 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_WebPEncode_failed_s_config_s, __pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_15, 0, __pyx_t_22);
    __pyx_t_22 = 0;
    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_15, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 525, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_22, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
    <span class='error_goto'>__PYX_ERR(0, 525, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">526</span>: </pre>
<pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">527</span>:     cdata = memory_writer.mem[:memory_writer.size]</pre>
<pre class='cython code score-2 '>  __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyBytes_FromStringAndSize</span>(((const char*)__pyx_v_memory_writer.mem) + 0, __pyx_v_memory_writer.size - 0);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 527, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
  __pyx_v_cdata = ((PyObject*)__pyx_t_22);
  __pyx_t_22 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">528</span>:     free(memory_writer.mem)</pre>
<pre class='cython code score-0 '>  free(__pyx_v_memory_writer.mem);
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">529</span>:     WebPPictureFree(&amp;pic)</pre>
<pre class='cython code score-0 '>  WebPPictureFree((&amp;__pyx_v_pic));
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">530</span>:     if config.lossless:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_config.lossless != 0);
  if (__pyx_t_5) {
/* … */
    goto __pyx_L36;
  }
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">531</span>:         client_options["quality"] = 100</pre>
<pre class='cython code score-5 '>    if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_client_options, __pyx_n_u_quality, __pyx_int_100) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 531, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">532</span>:     elif quality&gt;=0 and quality&lt;=100:</pre>
<pre class='cython code score-0 '>  __pyx_t_4 = ((__pyx_v_quality &gt;= 0) != 0);
  if (__pyx_t_4) {
  } else {
    __pyx_t_5 = __pyx_t_4;
    goto __pyx_L37_bool_binop_done;
  }
  __pyx_t_4 = ((__pyx_v_quality &lt;= 0x64) != 0);
  __pyx_t_5 = __pyx_t_4;
  __pyx_L37_bool_binop_done:;
  if (__pyx_t_5) {
/* … */
  }
  __pyx_L36:;
</pre><pre class="cython line score-8" onclick='toggleDiv(this)'>+<span class="">533</span>:         client_options["quality"] = quality</pre>
<pre class='cython code score-8 '>    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_quality);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 533, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_client_options, __pyx_n_u_quality, __pyx_t_22) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 533, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">534</span>:     if alpha_int:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = (__pyx_v_alpha_int != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-5" onclick='toggleDiv(this)'>+<span class="">535</span>:         client_options["has_alpha"] = True</pre>
<pre class='cython code score-5 '>    if (unlikely(<span class='py_c_api'>PyDict_SetItem</span>(__pyx_v_client_options, __pyx_n_u_has_alpha, Py_True) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 535, __pyx_L1_error)</span>
</pre><pre class="cython line score-45" onclick='toggleDiv(this)'>+<span class="">536</span>:     log("webp.compress ratio=%i%%, client-options=%s", 100*memory_writer.size//size, client_options)</pre>
<pre class='cython code score-45 '>  __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_FromSize_t</span>(((0x64 * __pyx_v_memory_writer.size) / __pyx_v_size));<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_18 = NULL;
  __pyx_t_9 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
    __pyx_t_18 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
    if (likely(__pyx_t_18)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_18);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
      __pyx_t_9 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_15)) {
    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_webp_compress_ratio_i_client_opt, __pyx_t_10, __pyx_v_client_options};
    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_15, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_15)) {
    PyObject *__pyx_temp[4] = {__pyx_t_18, __pyx_kp_u_webp_compress_ratio_i_client_opt, __pyx_t_10, __pyx_v_client_options};
    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_15, __pyx_temp+1-__pyx_t_9, 3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  } else
  #endif
  {
    __pyx_t_14 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    if (__pyx_t_18) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_18); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0, __pyx_t_18); __pyx_t_18 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_webp_compress_ratio_i_client_opt);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_webp_compress_ratio_i_client_opt);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 0+__pyx_t_9, __pyx_kp_u_webp_compress_ratio_i_client_opt);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 1+__pyx_t_9, __pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_client_options);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_client_options);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_14, 2+__pyx_t_9, __pyx_v_client_options);
    __pyx_t_10 = 0;
    __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_15, __pyx_t_14, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
</pre><pre class="cython line score-0" onclick='toggleDiv(this)'>+<span class="">537</span>:     if LOG_CONFIG&gt;0:</pre>
<pre class='cython code score-0 '>  __pyx_t_5 = ((__pyx_v_4xpra_6codecs_4webp_7encoder_LOG_CONFIG &gt; 0) != 0);
  if (__pyx_t_5) {
/* … */
  }
</pre><pre class="cython line score-41" onclick='toggleDiv(this)'>+<span class="">538</span>:         log("webp.compress used config: %s", get_config_info(&amp;config))</pre>
<pre class='cython code score-41 '>    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_log);<span class='error_goto'> if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_15);
    __pyx_t_14 = __pyx_f_4xpra_6codecs_4webp_7encoder_get_config_info((&amp;__pyx_v_config));<span class='error_goto'> if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_14);
    __pyx_t_10 = NULL;
    __pyx_t_9 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_15))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_15);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_15);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_15, function);
        __pyx_t_9 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_15)) {
      PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_kp_u_webp_compress_used_config_s, __pyx_t_14};
      __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_15, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_15)) {
      PyObject *__pyx_temp[3] = {__pyx_t_10, __pyx_kp_u_webp_compress_used_config_s, __pyx_t_14};
      __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_15, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_14); __pyx_t_14 = 0;
    } else
    #endif
    {
      __pyx_t_18 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_18);
      if (__pyx_t_10) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0, __pyx_t_10); __pyx_t_10 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_webp_compress_used_config_s);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_webp_compress_used_config_s);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 0+__pyx_t_9, __pyx_kp_u_webp_compress_used_config_s);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_14);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_18, 1+__pyx_t_9, __pyx_t_14);
      __pyx_t_14 = 0;
      __pyx_t_22 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_15, __pyx_t_18, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 538, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_18); __pyx_t_18 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_15); __pyx_t_15 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">539</span>:     return cdata, client_options</pre>
<pre class='cython code score-10 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 539, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_cdata);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_cdata);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_v_cdata);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_client_options);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_client_options);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1, __pyx_v_client_options);
  __pyx_r = __pyx_t_22;
  __pyx_t_22 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">540</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">541</span>: </pre>
<pre class="cython line score-49" onclick='toggleDiv(this)'>+<span class="">542</span>: def selftest(full=False):</pre>
<pre class='cython code score-49 '>/* Python wrapper */
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_11selftest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_4xpra_6codecs_4webp_7encoder_11selftest = {"selftest", (PyCFunction)__pyx_pw_4xpra_6codecs_4webp_7encoder_11selftest, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_4xpra_6codecs_4webp_7encoder_11selftest(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_full = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("selftest (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_full,0};
    PyObject* values[1] = {0};
    values[0] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_full);
          if (value) { values[0] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "selftest") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 542, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_full = values[0];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("selftest", 0, 0, 1, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 542, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.selftest", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_4xpra_6codecs_4webp_7encoder_10selftest(__pyx_self, __pyx_v_full);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_4xpra_6codecs_4webp_7encoder_10selftest(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_full) {
  PyObject *__pyx_v_make_test_image = NULL;
  PyObject *__pyx_v_w = NULL;
  PyObject *__pyx_v_h = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_pixels = NULL;
  PyObject *__pyx_v_has_alpha = NULL;
  PyObject *__pyx_v_img = NULL;
  PyObject *__pyx_v_q = NULL;
  PyObject *__pyx_v_r = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("selftest", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("xpra.codecs.webp.encoder.selftest", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_make_test_image);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_w);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_h);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_pixels);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_has_alpha);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_img);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_q);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_r);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(9, __pyx_n_s_full, __pyx_n_s_make_test_image, __pyx_n_s_w, __pyx_n_s_h, __pyx_n_s_pixels, __pyx_n_s_has_alpha, __pyx_n_s_img, __pyx_n_s_q, __pyx_n_s_r);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_3 = PyCFunction_NewEx(&amp;__pyx_mdef_4xpra_6codecs_4webp_7encoder_11selftest, NULL, __pyx_n_s_xpra_codecs_webp_encoder);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_selftest, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 542, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">543</span>:     #fake empty buffer:</pre>
<pre class="cython line score-15" onclick='toggleDiv(this)'>+<span class="">544</span>:     from xpra.codecs.codec_checks import make_test_image</pre>
<pre class='cython code score-15 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_make_test_image);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_make_test_image);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_make_test_image);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_xpra_codecs_codec_checks, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_make_test_image);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 544, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_make_test_image = __pyx_t_1;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-2" onclick='toggleDiv(this)'>+<span class="">545</span>:     w, h = 24, 16</pre>
<pre class='cython code score-2 '>  __pyx_t_2 = __pyx_int_24;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
  __pyx_t_1 = __pyx_int_16;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
  __pyx_v_w = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_h = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-26" onclick='toggleDiv(this)'>+<span class="">546</span>:     pixels = bytearray(b"\0" * w*h*4)</pre>
<pre class='cython code score-26 '>  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_kp_b__7, __pyx_v_w);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_1, __pyx_v_h);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_2, __pyx_int_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)(&amp;PyByteArray_Type)), __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 546, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_pixels = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">547</span>:     for has_alpha in (True, False):</pre>
<pre class='cython code score-11 '>  __pyx_t_1 = __pyx_tuple__8; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1); __pyx_t_3 = 0;
  for (;;) {
    if (__pyx_t_3 &gt;= 2) break;
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_1, __pyx_t_3); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_3++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 547, __pyx_L1_error)</span>
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_1, __pyx_t_3); __pyx_t_3++;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    #endif
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_has_alpha, __pyx_t_2);
    __pyx_t_2 = 0;
/* … */
  __pyx_tuple__8 = <span class='py_c_api'>PyTuple_Pack</span>(2, Py_True, Py_False);<span class='error_goto'> if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 547, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__8);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__8);
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-63" onclick='toggleDiv(this)'>+<span class="">548</span>:         img = make_test_image("BGR%s" % ["X", "A"][has_alpha], w, h)</pre>
<pre class='cython code score-63 '>    __pyx_t_4 = <span class='py_c_api'>PyList_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_X);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_X);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 0, __pyx_n_u_X);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_A);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_A);
    <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_4, 1, __pyx_n_u_A);
    __pyx_t_5 = <span class='py_c_api'>PyObject_GetItem</span>(__pyx_t_4, __pyx_v_has_alpha);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyUnicode_Format</span>(__pyx_kp_u_BGR_s, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_make_test_image);
    __pyx_t_5 = __pyx_v_make_test_image; __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_4, __pyx_v_w, __pyx_v_h};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[4] = {__pyx_t_6, __pyx_t_4, __pyx_v_w, __pyx_v_h};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_7, 3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    } else
    #endif
    {
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(3+__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      if (__pyx_t_6) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_6); __pyx_t_6 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0+__pyx_t_7, __pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_w);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_w);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1+__pyx_t_7, __pyx_v_w);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_h);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_h);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2+__pyx_t_7, __pyx_v_h);
      __pyx_t_4 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 548, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_img, __pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-11" onclick='toggleDiv(this)'>+<span class="">549</span>:         for q in (10, 50, 90):</pre>
<pre class='cython code score-11 '>    __pyx_t_2 = __pyx_tuple__9; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2); __pyx_t_9 = 0;
    for (;;) {
      if (__pyx_t_9 &gt;= 3) break;
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_t_2, __pyx_t_9); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5); __pyx_t_9++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 549, __pyx_L1_error)</span>
      #else
      __pyx_t_5 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_2, __pyx_t_9); __pyx_t_9++;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 549, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      #endif
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_q, __pyx_t_5);
      __pyx_t_5 = 0;
/* … */
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* … */
  __pyx_tuple__9 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_int_10, __pyx_int_50, __pyx_int_90);<span class='error_goto'> if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 549, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__9);
</pre><pre class="cython line score-35" onclick='toggleDiv(this)'>+<span class="">550</span>:             r = encode(img, quality=q, speed=50, supports_alpha=has_alpha)</pre>
<pre class='cython code score-35 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_encode);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 550, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 550, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_img);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_img);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_v_img);
      __pyx_t_4 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 550, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_quality, __pyx_v_q) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 550, __pyx_L1_error)</span>
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_speed, __pyx_int_50) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 550, __pyx_L1_error)</span>
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_supports_alpha, __pyx_v_has_alpha) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 550, __pyx_L1_error)</span>
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_8, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 550, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_r, __pyx_t_6);
      __pyx_t_6 = 0;
</pre><pre class="cython line score-10" onclick='toggleDiv(this)'>+<span class="">551</span>:             assert len(r)&gt;0</pre>
<pre class='cython code score-10 '>      #ifndef CYTHON_WITHOUT_ASSERTIONS
      if (unlikely(!Py_OptimizeFlag)) {
        __pyx_t_10 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_r);<span class='error_goto'> if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 551, __pyx_L1_error)</span>
        if (unlikely(!((__pyx_t_10 &gt; 0) != 0))) {
          <span class='py_c_api'>PyErr_SetNone</span>(PyExc_AssertionError);
          <span class='error_goto'>__PYX_ERR(0, 551, __pyx_L1_error)</span>
        }
      }
      #endif
</pre><pre class="cython line score-0">&#xA0;<span class="">552</span>:         #import binascii</pre>
<pre class="cython line score-0">&#xA0;<span class="">553</span>:         #print("compressed data(%s)=%s" % (has_alpha, binascii.hexlify(r)))</pre>
</div></body></html>
